<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Simple Workplace Scanner</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#0b0d12;
  color:#e8eaf0;
}
header{
  padding:14px 16px;
  background:#0f1320;
  border-bottom:1px solid #22283a;
}
main{
  max-width:900px;
  margin:auto;
  padding:16px;
}
.card{
  background:#11172a;
  border:1px solid #1f2740;
  border-radius:12px;
  padding:14px;
  margin-bottom:14px;
}
video{
  width:100%;
  border-radius:12px;
  border:1px solid #223055;
}
button,select,input{
  background:#25304f;
  color:#fff;
  border:0;
  padding:10px;
  border-radius:10px;
}
button{font-weight:700}
.row{display:flex;gap:10px;flex-wrap:wrap}
.tag{
  border:1px dashed #3a4a7a;
  padding:12px;
  border-radius:12px;
}
.price{font-size:36px;font-weight:900}
.muted{color:#aab3cf;font-size:13px}
</style>
</head>

<body>
<header>
  <h2>Workplace Price Scanner</h2>
</header>

<main>

<div class="card">
  <div class="row">
    <select id="cameraSelect">
      <option value="environment">Back Camera</option>
      <option value="user">Front Camera</option>
    </select>
    <button id="startBtn">Start</button>
    <button id="stopBtn" disabled>Stop</button>
  </div>

  <video id="video" playsinline muted></video>
</div>

<div class="card">
  <h3>Result</h3>
  <div id="result" class="tag muted">Scan a barcode</div>
</div>

</main>

<script src="https://unpkg.com/@zxing/library@0.21.3/umd/index.min.js"></script>

<script>
const video = document.getElementById("video");
const resultEl = document.getElementById("result");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const cameraSelect = document.getElementById("cameraSelect");

let items = new Map();
let codeReader = null;
let stream = null;

async function loadItems(){
  const res = await fetch("./items.json",{cache:"no-store"});
  const json = await res.json();
  items = new Map(json.map(i=>[String(i.barcode),i]));
}

function showItem(barcode){
  const item = items.get(barcode);
  if(item){
    resultEl.innerHTML = `
      <div class="price">$${item.price}</div>
      <div><b>${item.name}</b></div>
      <div class="muted">${item.department || ""}</div>
    `;
  }else{
    resultEl.innerHTML = `
      <b>Unknown barcode</b><br>
      <code>${barcode}</code>
    `;
  }
}

async function start(){
  await loadItems();

  codeReader = new ZXing.BrowserMultiFormatReader();

  stream = await navigator.mediaDevices.getUserMedia({
    video:{facingMode:cameraSelect.value}
  });

  video.srcObject = stream;
  await video.play();

  startBtn.disabled = true;
  stopBtn.disabled = false;

  codeReader.decodeFromVideoElement(video,(result,err)=>{
    if(result){
      const code = result.getText();
      showItem(code);
    }
  });
}

function stop(){
  if(codeReader) codeReader.reset();
  if(stream) stream.getTracks().forEach(t=>t.stop());
  startBtn.disabled = false;
  stopBtn.disabled = true;
}

startBtn.onclick = start;
stopBtn.onclick = stop;
</script>

</body>
</html>
